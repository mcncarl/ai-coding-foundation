# 提示工程实战

> 教你如何更有效地和AI沟通

---

# 第3章 高级提示工程

## 3.1 零样本，单样本与少样本

### 零样本（Zero-shot）

**是什么？**

直接问，不用给例子。

**通俗比喻**

就像对厨师说："给我炒个蛋炒饭。"厨师凭经验去做。

**适用场景**

- 简单任务、常见任务
- 你只需要一个大致的结果
- 时间紧急

**缺点**

- 可能"幻觉"（瞎编）
- 输出格式不稳定

**具体例子**

```
❌ "写个排序函数"
✅ "用Python写一个冒泡排序函数，输入列表，输出排序后的列表"
```

---

### 单样本（One-shot）

**是什么？**

给一个例子，让AI知道你的风格和格式。

**通俗比喻**

就像你对厨师说："就像上次我做的那样，蛋炒饭加火腿肠。"厨师就懂了。

**适用场景**

- 需要特定格式
- 指令有歧义需要澄清
- 想让AI按照某种风格输出

**具体例子**

```
这是例子：
```python
def add(a, b):
    '''计算两个数的和，返回a + b'''
    return a + b
```

现在帮我写一个相减的函数，格式要和上面一样。
```

AI会生成类似格式的代码：
```python
def subtract(a, b):
    '''计算两个数的差，返回a - b'''
    return a - b
```

---

### 少样本（Few-shot）

**是什么？**

给2-5个例子，让AI找出规律。

**通俗比喻**

就像你对厨师说：
- "上次蛋炒饭加火腿肠好吃"
- "上次扬州炒饭加了虾仁"
- "这次我做什锦炒饭，你参考之前的做法"

厨师就知道要参考之前的做法来调整。

**适用场景**

- 复杂逻辑
- 需要严格格式
- AI对某个领域不熟

**具体例子**

```
任务：把中文翻译成英文

例子1：
输入：你好
输出：Hello

例子2：
输入：再见
输出：Goodbye

现在请翻译：
输入：谢谢
输出：__
```

---

### 怎么选？

| 情况 | 建议 |
|------|------|
| 简单任务，如"打印HELLO" | 零样本 |
| 需要特定格式，如"用numpy风格注释" | 单样本 |
| 复杂逻辑，或AI不熟悉的领域 | 少样本 |

---

## 3.2 思维链（CoT）

### 是什么？

让AI不要直接给答案，而是先把思考过程写出来。

**通俗比喻**

就像老师教学生做题，要求写出解题步骤，这样不容易算错。

### 怎么用？

在指令里加一句："请一步一步思考"

### 为什么有用？

AI和人类一样，直接跳到答案容易出错。让它"说出来"，相当于自己检查了一遍。

### 示例1：计算折扣

**❌ 普通问法（容易出错）：**
```
写一个函数，根据年龄和会员状态计算折扣
```

AI可能搞不清楚折扣的优先级。

**✅ 用思维链：**
```
请一步一步思考如何实现这个函数：

1. 先判断是否是"未成年会员"（年龄<18 且 是会员）→ 72折
2. 再判断是否"未成年但不是会员" → 8折
3. 再判断是否"成年会员" → 9折
4. 其他情况不打折

现在按这个步骤写代码
```

### 示例2：斐波那契数列

**❌ 普通问法：**
```
写一个函数计算斐波那契数列第n个
```

**✅ 用思维链：**
```
请一步一步思考如何实现：

1. 如果n=0，返回0
2. 如果n=1，返回1
3. 如果n>1，用迭代：a=0, b=1, 循环更新
4. 最后返回b

现在按这个写代码
```

### 进阶：自我修正

还可以让AI写完后自己检查：

```
你对你写的代码满意吗？请检查有没有可能出错的地方，如果有，请修正。
```

---

## 3.3 结构化提示

### 是什么？

给AI一个模板，让它按格式填内容。

**通俗比喻**

就像填表格：
- ❌ 随便写
- ✅ 按表格格式填

### 函数模板

**为什么要用？**

让AI生成的代码有正确的签名、参数、返回值。

**具体例子：**

```
请生成一个Python函数，用于计算阶乘。请遵循以下结构：

```
# 函数签名：
def <函数名>(<参数>) -> <返回类型>:
    """
    <功能描述>

    参数:
        <参数> (<类型>): <说明>

    返回:
        <类型>: <说明>

    异常:
        <什么情况会报错>
    """
    # 实现逻辑
```

并且要处理负数输入，抛出ValueError。
```

**AI会生成：**
```python
def factorial(n: int) -> int:
    """
    计算阶乘

    参数:
        n (int): 非负整数

    返回:
        int: n的阶乘

    异常:
        ValueError: 如果n是负数
    """
    if n < 0:
        raise ValueError("不能是负数")
    # ... 继续实现
```

---

### 类模板

**具体例子：**

```
写一个"图书"类Book，包含：

- 属性：
  - title (str): 书名
  - author (str): 作者
  - isbn (str): 书号，13位数字
  - is_available (bool): 是否可借，默认为True

- 方法：
  - borrow(): 借书，如果可借返回True，否则False
  - return_book(): 还书，返回True
  - __str__(): 返回 "书名 by 作者" 格式
```

---

### API模板

**具体例子：**

```
写一个调用天气API的Python函数：

- API地址：https://api.example.com/weather
- 请求方式：GET
- 参数：
  - city (str, 必填): 城市名
  - units (str, 可选): metric(摄氏度) 或 imperial(华氏度)
- 返回格式：
  {"city": "北京", "temperature": 20, "description": "晴"}

- 要处理网络错误和API返回错误的情况
```

---

## 3.4 角色扮演与系统指令

### 角色扮演

**是什么？**

告诉AI它是谁，以什么身份回答。

**为什么要用？**

让AI以特定角度回答，更专业或更符合需求。

**具体例子：**

| 角色 | 效果 |
|------|------|
| "你是一位资深Python工程师" | 给出专业的Python代码 |
| "你是一位耐心的编程老师" | 解释详细，适合新手 |
| "你是一位架构师" | 给出系统设计建议 |
| "你是一个代码审查员" | 指出代码问题 |

**示例：**
```
你是一位资深的计算机科学教授，擅长数据结构与算法。
请用严谨的学术风格，详细解释二叉搜索树的插入操作。
```

---

### 系统指令

**是什么？**

告诉AI规矩，什么能做，什么不能做。

**具体例子：**

| 指令 | 效果 |
|------|------|
| "所有回答用中文" | 输出中文 |
| "代码必须带注释" | 生成的代码有注释 |
| "只回答问题，不要废话" | 输出简洁 |
| "不要使用第三方库" | 只用标准库 |

---

### 结合使用

**具体例子：**

```
你是一位专为零基础学生讲解Python的老师。

要求：
- 用通俗易懂的语言
- 每行代码都要中文注释
- 不要用专业术语
- 举例要贴近生活
```

---

## 3.5 高级推理方法

### LTSS（Let's Think Step by Step）

**是什么？**

一句非常短的触发词，让模型自动进入"慢慢推理"状态。

**通俗比喻**

就像对AI说"慢慢想，不着急"，它就会更认真地推理。

**什么时候用？**

你不想写示例，但又希望它认真推理时。

**具体例子：**

```
问题：小明有5个苹果，小红给了他3个，小明吃掉了2个，现在小明有几个苹果？

让我们一步步思考。
```

这就是"最轻量版CoT开关"，比完整写CoT更简单。

---

### ToT（Tree of Thoughts）

**是什么？**

不是只想一条路，而是同时想几条路，比较后再选。

**通俗比喻**

就像下棋时，不是只考虑下一步，而是考虑几步之后的多种可能。

**什么时候用？**

路线规划、方案比较、复杂决策这类"有多种解法"的问题。

**具体例子：**

```
问题：如何从北京去上海最省钱？

请按以下步骤思考：
1. 提出3种可行方案（飞机、高铁、自驾）
2. 分别估算每种方案的花费和时间
3. 比较优缺点
4. 给出最优建议
5. 如果预算不够，有没有备选方案？
```

---

### Self-Consistency（自我一致性）

**是什么？**

同一道题让模型答多次，最后取"多数答案"。

**通俗比喻**

就像投票表决，多个人投票，取多数意见。

**什么时候用？**

有标准答案、且你怕单次回答不稳的时候。

**具体例子：**

```
计算：25 × 37 + 75 × 37 = ?

请用Python计算3次，然后取多数一致的结果。
```

**原理：**

- 同一道计算题跑5次
- 结果可能是：3700、3700、3600、3700、3700
- 最终取 3700（出现3次）

**代价：**

用稳定性换成本——需要消耗更多token。

---

### ReAct（Reason + Act）

**是什么？**

一边想，一边查，一边根据新信息继续想。

**通俗比喻**

就像人做事时，遇到不确定的就查资料，查完再继续。

**什么时候用？**

需要上网查资料、查数据库、调用工具的任务。

**具体例子：**

```
问题：今天北京天气怎么样？

请按以下步骤：
1. 思考：需要先查天气
2. 行动：调用天气工具
3. 观察：晴天、温度25度
4. 回答：今天北京晴，25度，适合穿薄外套
```

**流程：**

```
你提需求
→ AI思考要做什么
→ AI调用工具（搜索、API、代码等）
→ 工具返回结果
→ AI根据结果继续推理
→ 最终回答你
```

---

## 3.6 DSPy自动提示优化

### 是什么？

你告诉系统"我要什么效果"，它自动帮你调提示和流程。

**通俗比喻**

就像请了一个教练，你告诉它目标，它自动帮你调整训练方法。

**什么时候用？**

你要长期跑同类任务，不想每次靠手工试错时。

**具体例子：**

```
目标：客服问答准确率>90%

做法：
1. 给一批历史问答当训练样本
2. 定义评估指标
3. 系统自动迭代提示版本
4. 挑最优版本上线
```

**一句话**

DSPy像"自动调参教练"，适合工程化。

---

## 3.7 方法选择决策表

### 任务类型 → 推荐技术

| 任务类型 | 首选方法 | 备选/增强 | 不建议 |
|---|---|---|---|
| 简单事实问答 | Zero-shot | 结构化输出 | ToT、复杂链路 |
| 数学/逻辑推理 | CoT 或 LTSS | Self-Consistency、ToT | 纯创意提示 |
| 多路径搜索/规划 | ToT | CoT + 回溯 | 只用 Zero-shot |
| 需查最新信息 | ReAct + RAG | 工具调用 + 来源约束 | 纯内推理 |
| 严格格式输出 | Template/JSON | 角色 + 约束 | 自由发挥 |
| 长对话/长文档 | MemGPT 思路 | RAG + 分段摘要 | 单轮上下文硬塞 |
| 复杂流程系统化优化 | DSPy | 评估集 + 指标编译 | 只靠手工调提示 |
| 代码真实修复能力评估 | SWE-Bench | SWE-Bench Lite | 只看玩具题 |

---

## 3.8 提示技巧补充

### 预填充（Prefill）

**是什么？**

先给模型一个回答开头，约束风格与方向。

**具体例子：**

```
用户：解释什么是Python

AI回答的开头：Python是一种...
```

你可以在提问时直接给出开头，让AI顺着这个方向继续：

```
请继续这个解释：Python是一种高级编程语言，特点是...
```

### 上下文位置

**是什么？**

重要信息放在前面，AI会更注意。

**具体例子：**

```
❌ 前面说一堆背景，最后才问问题
✅ 直接在前面问关键问题，后面再补充背景
```

### Temperature参数

**是什么？**

控制输出的随机性。

| 值 | 效果 | 适用场景 |
|-----|------|----------|
| 低（0.1-0.3） | 稳定、确定性 | 事实类、代码 |
| 中（0.5-0.7） | 平衡 | 一般对话 |
| 高（0.8-1.0） | 发散、创意 | 写小说、头脑风暴 |

### Few-shot例子选择

**原则：**

| 原则 | 说明 |
|------|------|
| 相似性 | 例子和问题越像越好 |
| 多样性 | 例子要覆盖不同情况 |
| 实用性 | 例子要简洁易懂 |

### 例子排序

| 排序方式 | 效果 |
|----------|------|
| 难题在前 | 让AI先思考难的 |
| 目标近邻在后 | 最后一个例子最像你要问的 |
| 随机多次 | 不确定时多试几次对比 |

---

## 3.9 反幻觉清单

AI容易犯的8个错，你要注意：

| 序号 | 坑 | 解决方案 |
|------|-----|----------|
| 1 | 提示模糊 | 改成可判定、可执行、可验收 |
| 2 | 指令和数据混写 | 用明确分隔符（如`---`、标签） |
| 3 | 只看单次样例 | 至少做小批量评估 |
| 4 | 不给来源还要求事实 | 改为检索+引用 |
| 5 | 复杂任务一口吃 | 强制拆分子任务 |
| 6 | 忽略参数 | 事实任务降温度，创意任务升温度 |
| 7 | 无停止条件 | 设置stop序列或输出协议 |
| 8 | 没有评估只改提示 | 先建评估，再谈优化 |

---

## 3.10 通用提示流水线

### 推荐流程

```
定义目标与评估指标
→ Zero-shot基线
→ Few-shot补齐边界
→ CoT/LTSS提升推理
→ ReAct/RAG接入外部证据
→ JSON结构化输出
→ DSPy自动优化
→ SWE-Bench或任务基准回归验证
```

### 说明

1. **先跑起来**：Zero-shot快速验证想法
2. **补边界**：Few-shot覆盖特殊情况
3. **提推理**：CoT让复杂任务更准
4. **接外部**：ReAct/RAG让AI能查资料
5. **定格式**：JSON方便程序处理
6. **自动化**：DSPy省去手工调参
7. **验证效果**：用真实基准测试

---

# 总结

| 技巧 | 适用场景 | 关键 |
|------|----------|------|
| 零样本 | 简单任务 | 指令要清晰 |
| 单样本 | 需要格式 | 给一个例子 |
| 少样本 | 复杂逻辑 | 给多个例子 |
| 思维链 | 多步骤推理 | 请一步一步思考 |
| 结构化 | 要特定格式 | 给模板 |
| 角色扮演 | 指定风格 | 设定身份 |
| 系统指令 | 定规矩 | 说明要求 |
