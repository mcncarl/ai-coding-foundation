# AI编程应用

> 教你怎么用AI来实际干活

---

# 第4章 AI实战应用

## 4.1 生成项目脚手架

### 什么是脚手架？

新项目启动时要创建的标准文件、文件夹、配置文件。

**通俗比喻**

就像你要开一家店：
- 以前：自己买货架、装修、办证
- 现在：有人给你一个"开店套餐"，全套搞定

### 怎么让AI生成？

告诉AI这4件事：

1. **用什么技术？**
   - Python Flask
   - React TypeScript
   - Vue3 + Vite

2. **要什么功能？**
   - 用户认证
   - 数据库连接
   - REST API

3. **文件结构长什么样？**
   - app/、tests/、config/
   - routes/、models/、services/

4. **关键文件内容？**
   - requirements.txt 包含什么
   - README.md 怎么写

### 具体示例

**❌ 问得太简单：**
```
帮我生成一个Flask项目
```

**✅ 问得详细：**
```
帮我生成一个Flask项目，包含：

1. 技术栈：Python 3.9+, Flask, SQLAlchemy
2. 目录结构：
   - app/
     - routes/
     - models/
   - tests/
   - config.py
   - requirements.txt
   - README.md

3. 文件内容要求：
   - config.py：包含Config类，SECRET_KEY和数据库配置
   - requirements.txt：包含Flask、SQLAlchemy、Flask-SQLAlchemy
   - app/routes/auth.py：写一个用户注册路由
   - app/models/user.py：定义User模型

4. 用法要写清楚
```

---

## 4.2 语言翻译器

### 是什么？

你说人话，AI帮你写成代码。

**通俗比喻**

就像你有个翻译，你说什么，它帮你翻成目标语言。

### 怎么用？

#### 1. 明确语言

| 差 | 好 |
|----|-----|
| "写排序" | "用Python写冒泡排序" |

#### 2. 描述具体

| 差 | 好 |
|----|-----|
| "写个函数" | "写一个函数，输入列表返回从小到大排序后的列表" |

#### 3. 说明依赖的库

```
"用requests库发GET请求到 https://api.example.com/data"
```

#### 4. 说明代码风格

```
"代码要符合PEP 8规范"
"用TypeScript，添加类型注解"
```

#### 5. 给例子

```
输入：[1,2,3]
输出：[3,2,1]

请写一个反转列表的函数
```

### 完整示例

**❌ 问得模糊：**
```
写个函数处理数据
```

**✅ 问得清楚：**
```
用Python写一个函数，计算列表中所有偶数的平方和。

例如：
输入：[1, 2, 3, 4, 5, 6]
输出：2² + 4² + 6² = 4 + 16 + 36 = 56
```

---

## 4.3 自动化测试

### 单元测试

测试单个函数/方法对不对。

**通俗比喻**

就像质检员检查每个零件是否合格。

#### 具体步骤

1. **给AI看被测代码**
2. **告诉用什么测试框架**（pytest、JUnit、Jest）
3. **说明要测哪些情况**

#### 示例：测试阶乘函数

**被测代码：**
```python
def factorial(n: int) -> int:
    """计算n的阶乘"""
    if n < 0:
        raise ValueError("不能是负数")
    if n == 0:
        return 1
    return n * factorial(n-1)
```

**让AI生成测试：**
```
请为上面的Python函数生成pytest单元测试。

需要覆盖：
1. 正常计算：factorial(5)应该是120
2. 边界条件：factorial(0)应该是1
3. 负数输入：factorial(-1)应该抛出ValueError
4. 非整数输入：factorial(1.5)应该抛出TypeError
```

**AI生成的测试：**
```python
import pytest
from my_module import factorial

def test_factorial_positive():
    assert factorial(5) == 120
    assert factorial(3) == 6
    assert factorial(1) == 1

def test_factorial_zero():
    assert factorial(0) == 1

def test_factorial_negative():
    with pytest.raises(ValueError):
        factorial(-1)

def test_factorial_non_integer():
    with pytest.raises(TypeError):
        factorial(1.5)
```

---

### 集成测试

测试多个模块配合对不对。

**通俗比喻**

就像把零件组装成整机，测试能否正常工作。

#### 示例

**场景**：测试"用户注册 → 保存到数据库"这个流程

```python
# 告诉AI
class UserService:
    def __init__(self, db):
        self.db = db

    def register(self, username, email):
        # 检查用户是否存在
        if self.db.get(username):
            return False
        # 保存用户
        return self.db.save(username, email)

请生成集成测试，验证：
1. 新用户能成功注册
2. 重复用户名注册失败
3. 用户数据被正确保存
```

---

## 4.4 学习新框架

### AI能帮你做什么？

#### 1. 解释概念

```
"FastAPI是什么？它和Flask有什么区别？"
"useEffect_hook是用来干嘛的？"
"什么是响应式编程？"
```

#### 2. 写示例代码

```
"帮我写一个Vue3的组件，用script setup语法"
"用Spring Boot写一个REST接口"
"用pandas读取CSV文件"
```

#### 3. 帮忙Debug

把错误贴给AI：

```
这个错误是什么意思？
TypeError: 'NoneType' object is not iterable

我的代码：
for item in items:
    print(item)

items是一个列表，为什么会报错？
```

---

## 4.5 RAG检索增强

### 是什么？

RAG = 检索增强生成（Retrieval-Augmented Generation）

先找相关资料，再基于资料回答。

**通俗比喻**

就像考试时让你"先翻书找答案，再回答"——不是凭记忆瞎编，而是真的有依据。

**什么时候用？**

- 需要准确的事实答案
- 需要引用具体来源
- 你的问题需要特定资料

### 和普通AI的区别

| 方式 | 说明 |
|------|------|
| 普通AI | 直接凭记忆回答，可能瞎编 |
| RAG | 先搜索相关资料，再基于资料回答 |

### 具体例子

**❌ 普通问法（可能幻觉）：**
```
Python的flask框架是谁开发的？
```
AI可能记错了，随口说是Google开发的。

**✅ 用RAG：**
```
请先检索Python的flask框架相关信息，
然后回答：flask框架是谁开发的？给出来源。
```

AI会：
1. 先搜索flask相关信息
2. 找到：Flask由Armin Ronacher开发
3. 给出答案并注明来源

### 怎么用？

1. **把你的资料给AI**
   ```
   以下是公司的产品文档：
   [粘贴文档内容]

   基于以上文档，回答用户问题：我们的退换货政策是什么？
   ```

2. **让AI引用来源**
   ```
   回答时必须标注来源。
   如果资料里没有明确说明，请回答"我没有找到相关信息"。
   ```

3. **结合工具调用**
   ```
   请先搜索最新的Python 3.12新特性，
   然后告诉我有哪些重要的更新。
   ```

---

# 第5章 AI辅助工作

## 5.1 智能错误分析

### 怎么问AI？

#### 1. 贴出完整错误信息

- 错误类型和消息（如 `TypeError: xxx`）
- 完整的堆栈跟踪（Traceback）
- 任何警告信息

#### 2. 给出相关代码

- 最小可复现示例（只贴出问题代码）
- 说明错误发生在哪里

#### 3. 说明预期 vs 实际

- 你想让代码干什么
- 代码实际出了什么错

### 具体示例

**❌ 信息不全：**
```
我的代码报错了，怎么办？
```

**✅ 信息完整：**
```
我的Python代码报错：

错误信息：
TypeError: unsupported operand type(s) for +: 'str' and 'int'

完整Traceback：
Traceback (most recent call last):
  File "test.py", line 5, in <module>
    result = "total: " + value
  File "test.py", line 3, in <module>
    value = int(input())

代码：
value = int(input())  # 用户输入了abc
result = "total: " + value  # 这行报错

预期：用户输入数字时显示"total: xxx"
实际：用户输入abc时程序崩溃
```

**AI分析：**
```
这个错误说明：
1. 用户输入了"abc"，无法转换成整数
2. int("abc") 会抛出 ValueError
3. 即使转换成功，"字符串" + "数字" 也会报错

修复建议：
1. 先检查输入是否是数字
2. 转换时用try-except捕获错误
```

---

## 5.2 代码重构

### 什么是重构？

不改变功能，把代码改得更易懂、更易维护。

**通俗比喻**

就像把杂乱的房间整理干净——东西还是那些东西，但摆放更有序了。

### 怎么让AI帮你？

#### 1. 识别问题

```
"帮我看看这段代码有什么问题"
```

#### 2. 获取建议

```
"这个函数太长了，怎么拆？"
"这个变量名不清楚，怎么改？"
```

#### 3. 直接修改

```
"把变量a改名为user_age"
"把这段重复代码提取成一个函数"
```

### 常见重构类型

| 之前 | 之后 | 说明 |
|------|------|------|
| `def calc(a, b)` | `def calculate_price(price, rate)` | 变量名有意义 |
| `if status == "p"` | `PENDING = "p"` | 魔法数字变常量 |
| 嵌套5层if | 用函数拆分 | 减少嵌套 |
| 重复代码 | 提取成函数 | 消除重复 |

### 示例

**重构前：**
```python
def process_order(items, shipping, is_vip):
    total = 0
    for i in items:
        total += i['price'] * i['count']
    if total > 100:
        total *= 0.9
    if is_vip:
        shipping = 0
    elif total < 50:
        shipping += 5
    tax = total * 0.08
    return (total + shipping) * (1 + tax)
```

**让AI重构后：**
```python
DISCOUNT_THRESHOLD = 100
DISCOUNT_RATE = 0.9
FREE_SHIPPING_THRESHOLD = 50
EXTRA_SHIPPING_FEE = 5
TAX_RATE = 0.08

def calculate_subtotal(items):
    return sum(i['price'] * i['count'] for i in items)

def apply_discount(total):
    return total * DISCOUNT_RATE if total > DISCOUNT_THRESHOLD else total

def calculate_shipping(total, is_vip):
    if is_vip:
        return 0
    return FREE_SHIPPING_FEE if total < FREE_SHIPPING_THRESHOLD else 0

def calculate_tax(amount):
    return amount * TAX_RATE

def process_order(items, shipping, is_vip):
    subtotal = calculate_subtotal(items)
    subtotal = apply_discount(subtotal)
    shipping = calculate_shipping(subtotal, is_vip)
    tax = calculate_tax(subtotal + shipping)
    return subtotal + shipping + tax
```

---

## 5.3 性能优化

### 常见性能问题

#### 1. 重复排序

```python
# ❌ 差：排了5次
for _ in range(5):
    result.sort()

# ✅ 好：排1次
result.sort()
```

#### 2. 字符串拼接

```python
# ❌ 差：每次循环创建新字符串
s = ""
for item in items:
    s += str(item) + ","

# ✅ 好：用join
s = ",".join(map(str, items))
```

#### 3. 在循环里做不需要循环的事

```python
# ❌ 差：每次都调用
for item in items:
    result.append(expensive_func(item))

# ✅ 好：先定义
# 或者用列表推导式
result = [expensive_func(item) for item in items]
```

### 怎么让AI优化？

```
"帮我优化这个函数，让它跑得更快"
```

**可以指定优化目标：**
- "优化内存使用"
- "减少CPU占用"
- "加快响应时间"

---

## 5.4 安全审计

### 常见漏洞

| 漏洞 | 危险 | 例子 |
|------|------|------|
| SQL注入 | 黑客操控数据库 | `query = f"SELECT * FROM users WHERE name = '{input}'"` |
| XSS | 网页注入脚本 | `<p>{{ user_input }}</p>` |
| 硬编码密码 | 密码泄露 | `PASSWORD = "123456"` |
| 权限漏洞 | 没检查权限 | 直接访问任意用户数据 |

### 怎么让AI审计？

**基本问法：**
```
"帮我审查这段代码，看看有没有安全漏洞"
```

**具体问法：**
```
"帮我检查有没有SQL注入和XSS漏洞"
```

### 示例

**有漏洞的代码：**
```python
# 危险！
username = input("请输入用户名：")
query = f"SELECT * FROM users WHERE name = '{username}'"
```

**AI会指出：**
```
问题：SQL注入漏洞

原因：用户输入直接拼接到SQL语句中，黑客可以输入：
' OR '1'='1

这样会变成：
SELECT * FROM users WHERE name = '' OR '1'='1'

修复建议：使用参数化查询
cursor.execute("SELECT * FROM users WHERE name = ?", (username,))
```

---

# 总结

| 场景 | AI能帮你 |
|------|----------|
| 写项目 | 生成脚手架 |
| 写代码 | 人话转代码 |
| 测试 | 生成测试用例 |
| 学新东西 | 解释概念、写例子 |
| 修bug | 分析错误 |
| 优化 | 重构、提速 |
| 安全 | 查漏洞 |
